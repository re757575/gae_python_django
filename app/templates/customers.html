<!DOCTYPE HTML>
<html style="height: 100%">
<head>
 <title>Clone of Excuses For Lazy Coders</title>
 <link rel="stylesheet" href="https://storage.googleapis.com/code.getmdl.io/1.0.6/material.indigo-pink.min.css">
 <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>
<body style="height: 100%">
 <div class="wrapper" style="min-height: 100%; height: auto !important; height: 100%; margin: 0 auto -8em;">
  <center style="color: #333; padding-top: 200px; font-family: Courier; font-size: 20px; font-weight: bold;">
      <div>
          {{ excuse }}
      </div>
      <br/>
      <form action="" method="post">
          {% csrf_token %}
          <div>客戶名稱: <input type="text" name="clientName" value="{{ customer.clientName }}"></div>
          <div>客戶類型: <input type="text" name="type" value="{{ customer.type }}"></div>
          <div>客戶地址: <input type="text" name="clientAddress" value="{{ customer.clientAddress }}"></div>
          <div>客戶電話: <input type="text" name="clientTel" value="{{ customer.clientTel }}"></div>
          <button type="submit" name="button">送出</button>
      </form>

    {% if customers %}
      <table>
          <tr>
              <th colspan="2">Action</th>
              <th>客戶名稱</th>
              <th>客戶類型</th>
              <th>客戶地址</th>
              <th>客戶電話</th>
              <th>建檔人員</th>
              <th>建檔時間</th>
          </tr>
          {% for c in customers %}
              <tr id="{{ c.key }}">
                  <td><a href="javascript:;" id="{{ c.key }}" class="del">刪除</a></td>
                  <td><a href="/customers/modify/5328783104016384" id="{{ c.key }}" class="modify">修改</a></td>
                  <td> {{ c.clientName }} </td>
                  <td> {{ c.type }} </td>
                  <td> {{ c.clientAddress }} </td>
                  <td> {{ c.clientTel }} </td>
                  <td> {{ c.createOperatorAccount }} </td>
                  <td> {{ c.createDateTime }} </td>
              </tr>
          {% endfor %}
      </table>
      {% endif %}
  </center>
  <div class="push"></div>
 </div>
 <div class="footer">
  <center style="color: #333; font-family: Courier; font-size: 11px;">
   <br /><br />&copy; Copyleft
  </center>
 </div>

 <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
 <script src="https://storage.googleapis.com/code.getmdl.io/1.0.6/material.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
 <script>

     $(document).ready(function() {

         $('a[class="del"]').click(function(event) {
             var _this = $(this);
             var id = $(this).attr('id');
             if (id != '') {
                 id = id.split(', ')[1].split(')')[0];
             }

             var conf = confirm("Delete file ?");
             if (conf == true) {
                 $.ajax({
                     url: '/customers/delete/'+ id,
                     type: "DELETE",
                     dataType: 'json',
                     beforeSend: function(xhr, settings) {
                        //  _this.hide();
                        if (!csrfSafeMethod(settings.type)) {
                            xhr.setRequestHeader("X-CSRFToken", $.cookie('csrftoken'));
                        }
                     },
                     error: function(error) {
                         alert(error.status +': '+error.statusText);
                        //  _this.show();
                     },
                     success: function(response) {
                         if (response.result == 1) {
                            _this.parent().parent('tr').fadeOut(500);
                         }
                         console.log(response.result);
                     }
                 });
             }

         });

         $('a[class="modify"]').each(function() {
             var id = $(this).attr('id');
             id = id.split(', ')[1].split(')')[0];
             $(this).attr('href', '/customers/modify/'+ id);
         });

     });

    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }
 </script>

 </body>
</html>
